<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Publica√ß√µes ‚Äì V & M EMPREENDIMENTOS S/A</title>
  <link rel="stylesheet" href="style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap" rel="stylesheet">
</head>
<body>
  <header>
    <h1>Publica√ß√µes Societ√°rias</h1>
    <nav>
      <a href="index.html">üè† Home</a>
      <a href="publicacoes.html">üìë Publica√ß√µes</a>
    </nav>
  </header>

  <main>
    <section class="filters">
      <label for="year">Ano:</label>
      <select id="year">
        <option value="">Todos</option>
      </select>

      <label for="type">Tipo:</label>
      <select id="type">
        <option value="">Todos</option>
      </select>
    </section>

    <p id="last-updated">√öltima atualiza√ß√£o em: --/--/----</p>

    <section id="results"></section>
  </main>

  <footer>
    <p>V & M EMPREENDIMENTOS S/A | CNPJ 35.969.294/0001-49</p>
  </footer>

  <script>
    async function loadPublications() {
      const response = await fetch("docs/manifest.json");
      const data = await response.json();

      const resultsContainer = document.getElementById("results");
      const yearSelect = document.getElementById("year");
      const typeSelect = document.getElementById("type");
      const lastUpdated = document.getElementById("last-updated");

      const publications = data.publications || [];

      // Preenche os filtros
      const years = [...new Set(publications.map(p => p.date.split("-")[0]))].sort().reverse();
      years.forEach(y => {
        const opt = document.createElement("option");
        opt.value = y;
        opt.textContent = y;
        yearSelect.appendChild(opt);
      });

      const types = [...new Set(publications.map(p => p.type))];
      types.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t;
        opt.textContent = t;
        typeSelect.appendChild(opt);
      });

      // √öltima atualiza√ß√£o
      if (data.updated_at) {
        const [y, m, d] = data.updated_at.split("-");
        lastUpdated.textContent = `√öltima atualiza√ß√£o em: ${d}/${m}/${y}`;
      }

      // Fun√ß√£o para renderizar os resultados
      function renderResults() {
        const selectedYear = yearSelect.value;
        const selectedType = typeSelect.value;

        const filtered = publications
          .filter(p => (!selectedYear || p.date.startsWith(selectedYear)) &&
                       (!selectedType || p.type === selectedType))
          .sort((a, b) => b.date.localeCompare(a.date));

        resultsContainer.innerHTML = "";

        if (filtered.length === 0) {
          resultsContainer.innerHTML = "<p>Nenhuma publica√ß√£o encontrada.</p>";
          return;
        }

        filtered.forEach(p => {
          const [y, m, d] = p.date.split("-");
          const item = document.createElement("div");
          item.className = "publication";
          item.innerHTML = `
            <p><strong>${d}/${m}/${y}</strong> ‚Äì ${p.type} ‚Äì ${p.title}
            ‚Äì <a href="docs/${p.file}" target="_blank">Ver Documento</a></p>
          `;
          resultsContainer.appendChild(item);
        });
      }

      // Atualiza ao trocar filtro
      yearSelect.addEventListener("change", renderResults);
      typeSelect.addEventListener("change", renderResults);

      renderResults();
    }

    loadPublications();
  </script>
</body>
</html>
